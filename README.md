# Assessment Management System

A full-stack app to authenticate users, generate assessment reports as PDFs based on a configuration-driven mapping system, and serve them for download.

## Repository Structure
```
assessment-management-system/
├─ Backend/
│  ├─ index.js                # Express server, auth, report generation
│  ├─ data.js                 # Sample session data (session_id-based)
│  ├─ config.json             # Report configuration (assessments, mappings)
│  ├─ templates/
│  │  └─ default.hbs          # Handlebars template for PDF
│  └─ reports/                # Generated PDFs (runtime output)
├─ frontend/
│  ├─ src/
│  │  ├─ App.js, App.css
│  │  ├─ Login.js, Signup.js, ReportForm.js
│  │  └─ index.js, index.css
│  ├─ package.json
│  └─ tailwind.config.js
├─ package.json               # Root scripts (dev, backend, frontend)
├─ .gitignore
└─ README.md
```

## Prerequisites
- Node.js 18+ and npm
- Windows/macOS/Linux with headless Chromium support (bundled via Puppeteer)

## Setup & Installation
```bash
# Install backend dependencies (root)
npm install

# Install frontend dependencies
npm install --prefix frontend
```

### Environment Variables
Create `Backend/.env` (optional) to override defaults:
```
PORT=5000
JWT_SECRET=your_strong_secret
```

## Running the App
```bash
# Start backend + frontend together (dev)
npm run dev

# Start backend only (http://localhost:5000)
npm run backend

# Start frontend only (http://localhost:3000)
npm run frontend
```
The frontend proxies API calls to `http://localhost:5000` (see `frontend/package.json` → `proxy`).

## Data Setup
- All sample data lives in `Backend/data.js` and is structured as an array keyed by `session_id`.
```js
[
  { "session_id": "session_001", "assessment_id": "as_hr_02", ... },
  { "session_id": "session_002", "assessment_id": "as_card_01", ... }
]
```
- Reports are generated by querying with `session_id`. Ensure your sample records are present and accurate for demos.

---

## Configuration System Documentation

The configuration is stored in `Backend/config.json`. Each top-level key corresponds to an assessment type (e.g., `as_hr_02`, `as_card_01`). The backend renders reports based on:

- The assessment’s `dataSource` (local/file/http)
- `sections` and field mappings (data paths, formatting, classification)
- The Handlebars template in `Backend/templates/` (default: `default.hbs`)

### How the Configuration System Works
1. A request is sent to `/generate-report` with `session_id`.
2. `Backend/index.js` resolves the assessment type (`reportType`) from the data and loads the session data from the configured `dataSource`.
3. For each section and field in `config.json`, it resolves paths, formats values, applies classification, and passes the results to the template.
4. Puppeteer renders the HTML to PDF and saves it under `Backend/reports/`.

### Data Sources (per assessment)
- Local (default):
```json
"dataSource": { "type": "local" }
```
- File:
```json
"dataSource": { "type": "file", "path": "./sessions/{{session_id}}.json" }
```
- HTTP:
```json
"dataSource": {
  "type": "http",
  "url": "https://api.example.com/session/{{session_id}}",
  "headers": { "Authorization": "Bearer {{env.API_TOKEN}}" }
}
```
Interpolation supports `{{session_id}}`, `{{assessment_id}}`, `{{PORT}}`, and `{{env.VAR}}`.

### Path Mapping Syntax
Use in `config.json` under `sections`:
- Dot paths: `vitalsMap.vitals.bp_sys`
- Array index: `exercises[0].setList[0].time`
- Array filter: `exercises[id=235].setList[0].time`
- Quoted filters: `items[name="Jog test"]`

You can map a field using a string path or an object with options:
```json
"Overall Health Score": { "path": "accuracy", "format": "percent", "classify": [ ... ] }
```

### Formatting
- `"format": "percent"` → 17 becomes `17%`
- `"format": "number"` → coerces to numeric string

### Classification Ranges
Add `classify` to any object-mapped field. First matching rule wins. Supported operators: `gt`, `gte`, `lt`, `lte`.
```json
"BMI": {
  "path": "bodyCompositionData.BMI",
  "classify": [
    { "lt": 18.5, "label": "Underweight" },
    { "gte": 18.5, "lt": 25, "label": "Normal" },
    { "gte": 25, "lt": 30, "label": "Overweight" },
    { "gte": 30, "label": "Obese" }
  ]
}
```

### Missing Values
If a mapped path is missing in the data, the template displays `Not available` (see `Backend/templates/default.hbs`).

### Examples from `Backend/config.json`
```json
{
  "as_card_01": {
    "template": "default.hbs",
    "dataSource": { "type": "local" },
    "sections": {
      "Key Body Vitals": {
        "Overall Health Score": { "path": "accuracy", "format": "percent" },
        "Heart Rate": "vitalsMap.vitals.heart_rate",
        "Blood Pressure Systolic": "vitalsMap.vitals.bp_sys",
        "Blood Pressure Diastolic": "vitalsMap.vitals.bp_dia"
      },
      "Cardiovascular Endurance": {
        "Jog Test Time": "exercises[id=235].setList[0].time",
        "Heart Utilized %": "vitalsMap.metadata.heart_scores.heart_utilized"
      },
      "Body Composition": {
        "BMI": "bodyCompositionData.BMI",
        "Lean Mass": "bodyCompositionData.LM"
      }
    }
  }
}
```

### How to Add New Assessment Types
1. Add a new top-level key in `Backend/config.json` matching your `assessment_id`.
2. Set `template`, `dataSource`, and define `sections` with field mappings.
3. Ensure your data (`Backend/data.js`, file, or HTTP) matches the paths you mapped.
4. Restart the backend.

### How to Modify Field Mappings
Edit the appropriate `sections` in `Backend/config.json`. Example:
```json
"Heart Rate": "vitalsMap.vitals.heart_rate",
"Overall Health Score": { "path": "accuracy", "format": "percent" }
```

### How to Update Classification Ranges
Modify the `classify` array on any object-mapped field:
```json
"Stress Index": {
  "path": "vitalsMap.metadata.heart_scores.stress_index",
  "classify": [
    { "lte": 1.5, "label": "Low" },
    { "gt": 1.5, "lte": 3, "label": "Moderate" },
    { "gt": 3, "label": "High" }
  ]
}
```

---

## API Reference
- `POST /signup`
  - Body: `{ "username": "user", "password": "pass" }`
- `POST /login`
  - Body: `{ "username": "user", "password": "pass" }`
  - Response: `{ "token": "jwt" }`
- `POST /generate-report` (auth required)
  - Headers: `Authorization: Bearer <token>`
  - Body: `{ "session_id": "session_001" }`
  - Response: `{ "success": true, "file": "/reports/report_session_001.pdf" }`
- `GET /generate-report?session_id=session_001` (auth required)

Example cURL:
```bash
# Login
curl -s -X POST http://localhost:5000/login \
  -H "Content-Type: application/json" \
  -d '{"username":"demo","password":"demoPass123"}'

# Generate report
curl -s -X POST http://localhost:5000/generate-report \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer TOKEN" \
  -d '{"session_id":"session_001"}'
```